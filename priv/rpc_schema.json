{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "events": {
      "agent_abort": {
        "description": "Agent run was aborted.",
        "properties": {
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "agent_abort",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id"
        ],
        "type": "object"
      },
      "agent_end": {
        "description": "Agent has finished processing.",
        "properties": {
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "agent_end",
            "description": "Event type discriminator.",
            "type": "string"
          },
          "usage": {
            "description": "Cumulative token usage for the session.",
            "properties": {
              "completion_tokens": {
                "type": "integer"
              },
              "context_window": {
                "type": "integer"
              },
              "current_context_tokens": {
                "type": "integer"
              },
              "prompt_tokens": {
                "type": "integer"
              },
              "total_tokens": {
                "type": "integer"
              }
            },
            "required": [
              "completion_tokens",
              "context_window",
              "current_context_tokens",
              "prompt_tokens",
              "total_tokens"
            ],
            "type": "object"
          }
        },
        "required": [
          "type",
          "session_id"
        ],
        "type": "object"
      },
      "agent_recovered": {
        "description": "Agent process crashed and was restarted by the supervisor. Conversation history was reloaded from the surviving session.",
        "properties": {
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "agent_recovered",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id"
        ],
        "type": "object"
      },
      "agent_start": {
        "description": "Agent has started processing.",
        "properties": {
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "agent_start",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id"
        ],
        "type": "object"
      },
      "context_discovered": {
        "description": "Project context files were discovered during session initialization.",
        "properties": {
          "files": {
            "description": "Paths of discovered context files.",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "context_discovered",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "files"
        ],
        "type": "object"
      },
      "error": {
        "description": "An error occurred during processing.",
        "properties": {
          "reason": {
            "description": "Error description.",
            "type": "string"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "error",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "reason"
        ],
        "type": "object"
      },
      "message_delta": {
        "description": "A chunk of LLM-generated text.",
        "properties": {
          "delta": {
            "description": "The text fragment.",
            "type": "string"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "message_delta",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "delta"
        ],
        "type": "object"
      },
      "message_start": {
        "description": "LLM has started generating a message.",
        "properties": {
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "message_start",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id"
        ],
        "type": "object"
      },
      "skill_loaded": {
        "description": "An agent skill was dynamically loaded into context.",
        "properties": {
          "description": {
            "description": "Skill description.",
            "type": "string"
          },
          "name": {
            "description": "Skill name.",
            "type": "string"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "skill_loaded",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "name",
          "description"
        ],
        "type": "object"
      },
      "status_update": {
        "description": "Short status message describing what the agent is currently working on.",
        "properties": {
          "message": {
            "description": "Brief human-readable status.",
            "type": "string"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "status_update",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "message"
        ],
        "type": "object"
      },
      "sub_agent_event": {
        "description": "An event forwarded from a spawned sub-agent.",
        "properties": {
          "inner": {
            "description": "The wrapped agent event from the sub-agent (contains a type field and event-specific data).",
            "type": "object"
          },
          "parent_call_id": {
            "description": "The call_id of the parent sub_agent tool invocation.",
            "type": "string"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "sub_session_id": {
            "description": "The sub-agent's session ID.",
            "type": "string"
          },
          "type": {
            "const": "sub_agent_event",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "parent_call_id",
          "sub_session_id",
          "inner"
        ],
        "type": "object"
      },
      "thinking_delta": {
        "description": "A chunk of LLM thinking/reasoning text.",
        "properties": {
          "delta": {
            "description": "The thinking text fragment.",
            "type": "string"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "thinking_delta",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "delta"
        ],
        "type": "object"
      },
      "thinking_start": {
        "description": "LLM has started a thinking/reasoning block.",
        "properties": {
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "thinking_start",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id"
        ],
        "type": "object"
      },
      "tool_execution_end": {
        "description": "A tool has finished executing.",
        "properties": {
          "call_id": {
            "description": "Unique call identifier.",
            "type": "string"
          },
          "result": {
            "description": "Tool execution result object. Includes ok plus tool-specific payload fields.",
            "type": "object"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "tool": {
            "description": "Tool name.",
            "type": "string"
          },
          "type": {
            "const": "tool_execution_end",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "tool",
          "call_id",
          "result"
        ],
        "type": "object"
      },
      "tool_execution_start": {
        "description": "A tool has started executing.",
        "properties": {
          "args": {
            "description": "Tool arguments.",
            "type": "object"
          },
          "call_id": {
            "description": "Unique call identifier.",
            "type": "string"
          },
          "meta": {
            "description": "Human-readable summary of the invocation.",
            "type": "string"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "tool": {
            "description": "Tool name.",
            "type": "string"
          },
          "type": {
            "const": "tool_execution_start",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "tool",
          "call_id",
          "args",
          "meta"
        ],
        "type": "object"
      },
      "turn_end": {
        "description": "An LLM turn has ended (may be followed by tool calls).",
        "properties": {
          "message": {
            "description": "The assistant's message text.",
            "type": "string"
          },
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "turn_end",
            "description": "Event type discriminator.",
            "type": "string"
          }
        },
        "required": [
          "type",
          "session_id",
          "message"
        ],
        "type": "object"
      },
      "usage_update": {
        "description": "Live token usage update during a turn.",
        "properties": {
          "session_id": {
            "description": "Session this event belongs to.",
            "type": "string"
          },
          "type": {
            "const": "usage_update",
            "description": "Event type discriminator.",
            "type": "string"
          },
          "usage": {
            "description": "Current token usage snapshot.",
            "properties": {
              "completion_tokens": {
                "type": "integer"
              },
              "context_window": {
                "type": "integer"
              },
              "current_context_tokens": {
                "type": "integer"
              },
              "prompt_tokens": {
                "type": "integer"
              },
              "total_tokens": {
                "type": "integer"
              }
            },
            "required": [
              "completion_tokens",
              "context_window",
              "current_context_tokens",
              "prompt_tokens",
              "total_tokens"
            ],
            "type": "object"
          }
        },
        "required": [
          "type",
          "session_id",
          "usage"
        ],
        "type": "object"
      }
    },
    "methods": {
      "agent/abort": {
        "description": "Abort the current agent run.",
        "params": {
          "properties": {
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            }
          },
          "required": [
            "session_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {},
          "type": "object"
        }
      },
      "agent/prompt": {
        "description": "Send an async user prompt. Results stream as agent/event notifications.",
        "params": {
          "properties": {
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            },
            "text": {
              "description": "The user's prompt text.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "text"
          ],
          "type": "object"
        },
        "result": {
          "properties": {},
          "type": "object"
        }
      },
      "agent/state": {
        "description": "Get the current agent state.",
        "params": {
          "properties": {
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            }
          },
          "required": [
            "session_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "message_count": {
              "description": "Number of messages in history.",
              "type": "integer"
            },
            "model": {
              "description": "Current model.",
              "properties": {
                "id": {
                  "type": "string"
                },
                "provider": {
                  "type": "string"
                },
                "thinking_level": {
                  "type": "string"
                }
              },
              "required": [
                "id",
                "provider",
                "thinking_level"
              ],
              "type": "object"
            },
            "session_id": {
              "description": "Session ID.",
              "type": "string"
            },
            "status": {
              "description": "One of: idle, running, streaming.",
              "type": "string"
            },
            "tools": {
              "description": "Active tool names.",
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          },
          "required": [
            "session_id",
            "status",
            "model",
            "message_count",
            "tools"
          ],
          "type": "object"
        }
      },
      "agent/steer": {
        "description": "Steer the agent mid-run. If idle, acts like agent/prompt.",
        "params": {
          "properties": {
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            },
            "text": {
              "description": "The steering message.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "text"
          ],
          "type": "object"
        },
        "result": {
          "properties": {},
          "type": "object"
        }
      },
      "auth/login": {
        "description": "Start the device-code OAuth login flow.",
        "params": {
          "properties": {},
          "type": "object"
        },
        "result": {
          "properties": {
            "device_code": {
              "description": "Device code for polling.",
              "type": "string"
            },
            "interval": {
              "description": "Polling interval in seconds.",
              "type": "integer"
            },
            "user_code": {
              "description": "Code for the user to enter.",
              "type": "string"
            },
            "verification_uri": {
              "description": "URL to visit.",
              "type": "string"
            }
          },
          "required": [
            "user_code",
            "verification_uri",
            "device_code",
            "interval"
          ],
          "type": "object"
        }
      },
      "auth/poll": {
        "description": "Poll for device-code authorization and exchange for a Copilot token.",
        "params": {
          "properties": {
            "device_code": {
              "description": "Device code from auth/login.",
              "type": "string"
            },
            "interval": {
              "description": "Polling interval in seconds.",
              "type": "integer"
            }
          },
          "required": [
            "device_code",
            "interval"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "authenticated": {
              "description": "True once the user has authorized.",
              "type": "boolean"
            }
          },
          "required": [
            "authenticated"
          ],
          "type": "object"
        }
      },
      "auth/set_key": {
        "description": "Save an API key for a provider. Takes effect immediately.",
        "params": {
          "properties": {
            "api_key": {
              "description": "The API key to save.",
              "type": "string"
            },
            "provider": {
              "description": "Provider ID (e.g. 'anthropic', 'openai').",
              "type": "string"
            }
          },
          "required": [
            "provider",
            "api_key"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "ok": {
              "description": "True if the key was saved.",
              "type": "boolean"
            }
          },
          "required": [
            "ok"
          ],
          "type": "object"
        }
      },
      "auth/status": {
        "description": "Probe all credential sources and return auth readiness.",
        "params": {
          "properties": {},
          "type": "object"
        },
        "result": {
          "properties": {
            "auth": {
              "description": "Full probe result with provider list and readiness.",
              "properties": {
                "provider": {
                  "type": "string"
                },
                "providers": {
                  "items": {
                    "type": "object"
                  },
                  "type": "array"
                },
                "status": {
                  "type": "string"
                }
              },
              "required": [
                "provider",
                "providers",
                "status"
              ],
              "type": "object"
            },
            "authenticated": {
              "description": "True if any provider has credentials.",
              "type": "boolean"
            }
          },
          "required": [
            "authenticated",
            "auth"
          ],
          "type": "object"
        }
      },
      "model/set": {
        "description": "Change the model for a running session.",
        "params": {
          "properties": {
            "model_id": {
              "description": "Model ID to switch to.",
              "type": "string"
            },
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            },
            "thinking_level": {
              "description": "Reasoning effort: off, low, medium, high.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "model_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "model": {
              "description": "The new active model.",
              "properties": {
                "id": {
                  "type": "string"
                },
                "provider": {
                  "type": "string"
                },
                "thinking_level": {
                  "type": "string"
                }
              },
              "required": [
                "id",
                "provider",
                "thinking_level"
              ],
              "type": "object"
            }
          },
          "required": [
            "model"
          ],
          "type": "object"
        }
      },
      "models/list": {
        "description": "List available LLM models. Copilot models are always included. Pass providers to also list direct provider models.",
        "params": {
          "properties": {
            "providers": {
              "description": "Optional list of direct providers to include (e.g. [\"anthropic\", \"openai\"]).",
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          },
          "type": "object"
        },
        "result": {
          "properties": {
            "models": {
              "description": "Array of {id, name, provider, supports_thinking}.",
              "items": {
                "type": "object"
              },
              "type": "array"
            }
          },
          "required": [
            "models"
          ],
          "type": "object"
        }
      },
      "opal/config/get": {
        "description": "Get runtime feature and tool configuration for a session.",
        "params": {
          "properties": {
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            }
          },
          "required": [
            "session_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "distribution": {
              "description": "Erlang distribution state, or null if not active.",
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "properties": {
                    "cookie": {
                      "description": "Distribution cookie.",
                      "type": "string"
                    },
                    "node": {
                      "description": "Full node name (e.g. opal@hostname).",
                      "type": "string"
                    }
                  },
                  "required": [
                    "cookie",
                    "node"
                  ],
                  "type": "object"
                }
              ]
            },
            "features": {
              "description": "Current runtime feature flags.",
              "properties": {
                "debug": {
                  "type": "boolean"
                },
                "mcp": {
                  "type": "boolean"
                },
                "skills": {
                  "type": "boolean"
                },
                "sub_agents": {
                  "type": "boolean"
                }
              },
              "required": [
                "debug",
                "mcp",
                "skills",
                "sub_agents"
              ],
              "type": "object"
            },
            "tools": {
              "description": "Tool availability for the session.",
              "properties": {
                "all": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "disabled": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "enabled": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                }
              },
              "required": [
                "all",
                "disabled",
                "enabled"
              ],
              "type": "object"
            }
          },
          "required": [
            "distribution",
            "features",
            "tools"
          ],
          "type": "object"
        }
      },
      "opal/config/set": {
        "description": "Update runtime feature and tool configuration for a session.",
        "params": {
          "properties": {
            "distribution": {
              "description": "Erlang distribution config. Set {name, cookie?} to start, null to stop.",
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "properties": {
                    "cookie": {
                      "description": "Distribution cookie. Generated randomly if omitted.",
                      "type": "string"
                    },
                    "name": {
                      "description": "Short node name (e.g. opal).",
                      "type": "string"
                    }
                  },
                  "required": [
                    "name"
                  ],
                  "type": "object"
                }
              ]
            },
            "features": {
              "description": "Feature flags to update.",
              "properties": {
                "debug": {
                  "type": "boolean"
                },
                "mcp": {
                  "type": "boolean"
                },
                "skills": {
                  "type": "boolean"
                },
                "sub_agents": {
                  "type": "boolean"
                }
              },
              "required": [
                "debug",
                "mcp",
                "skills",
                "sub_agents"
              ],
              "type": "object"
            },
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            },
            "tools": {
              "description": "Exact list of enabled tool names.",
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          },
          "required": [
            "session_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "distribution": {
              "description": "Erlang distribution state, or null if not active.",
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "properties": {
                    "cookie": {
                      "description": "Distribution cookie.",
                      "type": "string"
                    },
                    "node": {
                      "description": "Full node name (e.g. opal@hostname).",
                      "type": "string"
                    }
                  },
                  "required": [
                    "cookie",
                    "node"
                  ],
                  "type": "object"
                }
              ]
            },
            "features": {
              "description": "Current runtime feature flags.",
              "properties": {
                "debug": {
                  "type": "boolean"
                },
                "mcp": {
                  "type": "boolean"
                },
                "skills": {
                  "type": "boolean"
                },
                "sub_agents": {
                  "type": "boolean"
                }
              },
              "required": [
                "debug",
                "mcp",
                "skills",
                "sub_agents"
              ],
              "type": "object"
            },
            "tools": {
              "description": "Tool availability for the session.",
              "properties": {
                "all": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "disabled": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "enabled": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                }
              },
              "required": [
                "all",
                "disabled",
                "enabled"
              ],
              "type": "object"
            }
          },
          "required": [
            "distribution",
            "features",
            "tools"
          ],
          "type": "object"
        }
      },
      "opal/ping": {
        "description": "Liveness check. Returns immediately.",
        "params": {
          "properties": {},
          "type": "object"
        },
        "result": {
          "properties": {},
          "type": "object"
        }
      },
      "opal/version": {
        "description": "Return server and protocol version information.",
        "params": {
          "properties": {},
          "type": "object"
        },
        "result": {
          "properties": {
            "protocol_version": {
              "description": "RPC protocol version (e.g. 0.1.0).",
              "type": "string"
            },
            "server_version": {
              "description": "Opal server version (e.g. 0.1.10).",
              "type": "string"
            }
          },
          "required": [
            "server_version",
            "protocol_version"
          ],
          "type": "object"
        }
      },
      "session/branch": {
        "description": "Branch the conversation at a specific message.",
        "params": {
          "properties": {
            "entry_id": {
              "description": "Message ID to branch from.",
              "type": "string"
            },
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "entry_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {},
          "type": "object"
        }
      },
      "session/compact": {
        "description": "Compact older messages in the session. (Not yet implemented.)",
        "params": {
          "properties": {
            "keep_recent": {
              "description": "Number of recent messages to keep. Default: 10.",
              "type": "integer"
            },
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            }
          },
          "required": [
            "session_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {},
          "type": "object"
        }
      },
      "session/delete": {
        "description": "Delete a saved session by ID.",
        "params": {
          "properties": {
            "session_id": {
              "description": "ID of the session to delete.",
              "type": "string"
            }
          },
          "required": [
            "session_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "ok": {
              "description": "True if deleted successfully.",
              "type": "boolean"
            }
          },
          "required": [
            "ok"
          ],
          "type": "object"
        }
      },
      "session/list": {
        "description": "List saved sessions on disk.",
        "params": {
          "properties": {},
          "type": "object"
        },
        "result": {
          "properties": {
            "sessions": {
              "description": "Array of {id, title, modified}.",
              "items": {
                "type": "object"
              },
              "type": "array"
            }
          },
          "required": [
            "sessions"
          ],
          "type": "object"
        }
      },
      "session/start": {
        "description": "Start a new agent session.",
        "params": {
          "properties": {
            "features": {
              "description": "Boot-time feature toggles.",
              "properties": {
                "debug": {
                  "type": "boolean"
                },
                "mcp": {
                  "type": "boolean"
                },
                "skills": {
                  "type": "boolean"
                },
                "sub_agents": {
                  "type": "boolean"
                }
              },
              "required": [
                "debug",
                "mcp",
                "skills",
                "sub_agents"
              ],
              "type": "object"
            },
            "mcp_servers": {
              "description": "MCP server configurations.",
              "items": {
                "type": "object"
              },
              "type": "array"
            },
            "model": {
              "description": "Model to use. Defaults to config default.",
              "properties": {
                "id": {
                  "type": "string"
                },
                "provider": {
                  "type": "string"
                }
              },
              "required": [
                "id",
                "provider"
              ],
              "type": "object"
            },
            "session": {
              "description": "If true, enable session persistence.",
              "type": "boolean"
            },
            "session_id": {
              "description": "Resume an existing session by ID. Implies session=true. The session is loaded from disk.",
              "type": "string"
            },
            "system_prompt": {
              "description": "System prompt for the agent.",
              "type": "string"
            },
            "tools": {
              "description": "Tool names to enable.",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "working_dir": {
              "description": "Working directory. Defaults to server cwd.",
              "type": "string"
            }
          },
          "type": "object"
        },
        "result": {
          "properties": {
            "auth": {
              "description": "Auth probe result: status is 'ready' or 'setup_required', provider is auto-selected ID or null, providers lists all known options with readiness.",
              "properties": {
                "provider": {
                  "type": "string"
                },
                "providers": {
                  "items": {
                    "type": "object"
                  },
                  "type": "array"
                },
                "status": {
                  "type": "string"
                }
              },
              "required": [
                "provider",
                "providers",
                "status"
              ],
              "type": "object"
            },
            "available_skills": {
              "description": "Names of discovered skills (not yet loaded).",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "context_files": {
              "description": "Paths of loaded context files.",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "mcp_servers": {
              "description": "Names of connected MCP servers.",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "node_name": {
              "description": "Erlang node name of the server (for debugging).",
              "type": "string"
            },
            "session_dir": {
              "description": "Filesystem path to the session's data directory.",
              "type": "string"
            },
            "session_id": {
              "description": "The new session's unique ID.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "session_dir",
            "context_files",
            "available_skills",
            "mcp_servers",
            "node_name",
            "auth"
          ],
          "type": "object"
        }
      },
      "settings/get": {
        "description": "Get all persistent user settings.",
        "params": {
          "properties": {},
          "type": "object"
        },
        "result": {
          "properties": {
            "settings": {
              "description": "Map of setting key-value pairs.",
              "type": "object"
            }
          },
          "required": [
            "settings"
          ],
          "type": "object"
        }
      },
      "settings/save": {
        "description": "Save user settings (merged with existing).",
        "params": {
          "properties": {
            "settings": {
              "description": "Map of setting key-value pairs to save.",
              "type": "object"
            }
          },
          "required": [
            "settings"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "settings": {
              "description": "The full settings after merge.",
              "type": "object"
            }
          },
          "required": [
            "settings"
          ],
          "type": "object"
        }
      },
      "tasks/list": {
        "description": "List active tasks (open, in_progress, blocked) for a session's project.",
        "params": {
          "properties": {
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            }
          },
          "required": [
            "session_id"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "tasks": {
              "description": "Array of task objects.",
              "items": {
                "type": "object"
              },
              "type": "array"
            }
          },
          "required": [
            "tasks"
          ],
          "type": "object"
        }
      },
      "thinking/set": {
        "description": "Change the reasoning effort level for the current model.",
        "params": {
          "properties": {
            "level": {
              "description": "Reasoning effort: off, low, medium, high.",
              "type": "string"
            },
            "session_id": {
              "description": "Target session ID.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "level"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "thinking_level": {
              "description": "The new thinking level.",
              "type": "string"
            }
          },
          "required": [
            "thinking_level"
          ],
          "type": "object"
        }
      }
    },
    "notification_method": "agent/event",
    "server_requests": {
      "client/ask_user": {
        "description": "Ask the user a question with optional multiple-choice answers.",
        "params": {
          "properties": {
            "choices": {
              "description": "Optional multiple-choice options.",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "question": {
              "description": "The question to display.",
              "type": "string"
            },
            "session_id": {
              "description": "Session this question belongs to.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "question"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "answer": {
              "description": "The user's response text.",
              "type": "string"
            }
          },
          "required": [
            "answer"
          ],
          "type": "object"
        }
      },
      "client/confirm": {
        "description": "Ask the user for confirmation (e.g., before executing a tool).",
        "params": {
          "properties": {
            "actions": {
              "description": "Available actions (e.g., [\"allow\", \"deny\", \"allow_session\"]).",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "message": {
              "description": "Detailed message to show.",
              "type": "string"
            },
            "session_id": {
              "description": "Session this confirmation belongs to.",
              "type": "string"
            },
            "title": {
              "description": "Short title for the confirmation dialog.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "title",
            "message",
            "actions"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "action": {
              "description": "The user's chosen action.",
              "type": "string"
            }
          },
          "required": [
            "action"
          ],
          "type": "object"
        }
      },
      "client/input": {
        "description": "Ask the user for freeform text input.",
        "params": {
          "properties": {
            "prompt": {
              "description": "Prompt to display to the user.",
              "type": "string"
            },
            "sensitive": {
              "description": "If true, input should be masked (e.g., API keys).",
              "type": "boolean"
            },
            "session_id": {
              "description": "Session this input request belongs to.",
              "type": "string"
            }
          },
          "required": [
            "session_id",
            "prompt"
          ],
          "type": "object"
        },
        "result": {
          "properties": {
            "text": {
              "description": "The user's input.",
              "type": "string"
            }
          },
          "required": [
            "text"
          ],
          "type": "object"
        }
      }
    }
  },
  "description": "Auto-generated from Opal.RPC.Protocol",
  "title": "Opal RPC Protocol",
  "version": "0.1.0"
}
